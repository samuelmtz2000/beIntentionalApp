# Streaks Feature Checkup — 2025-09-19

Summary
- Backend streak endpoints (general, per-habit, history) are live and used by iOS.
- iOS renders general streak in the header and per-habit streaks in list rows with 7-day dots and a history sheet.
- Remaining work focuses on configuration, header progress UI, and telemetry.

What’s Implemented
- API
  - GET `/streaks/general` → current/longest and today’s breakdown (80% threshold, unforgiven bad breaks; freeze on zero-good + no bad).
  - GET `/streaks/habits` → per-habit current/longest for good and bad.
  - GET `/streaks/habits/:id/history?type=good|bad` → 7-day statuses (good: done/miss/inactive; bad: clean/forgiven/occurred).
  - OpenAPI references present; tests exist for general and per-habit.
- iOS
  - ViewModels: `StreaksViewModel` loads generalToday, per-habit, and history.
  - Header: `PlayerHeader` shows general streak count with flame icon; small celebration on daySuccess.
  - List rows: `GoodHabitRow` / `BadHabitRow` show `StreakChip` and 7-day dots; history sheet available.
  - After actions: row view models refresh per-habit streaks and history.

Gaps / To‑Do
- Header progress meter
  - Add a small progress UI in the header: completedGood / totalActiveGood for today; colorize by at-risk state (unforgiven bad) and success threshold.
- Configuration
  - Expose streak threshold (default 80%) and potentially freeze policy in user config (backend + `UserConfigSheet`).
  - Persist per-user via `/users/:id/config` and apply in streak computations.
- Visual/UX polish
  - Richer celebration (sparkles/confetti) for header on day success; milestone celebrations at 7/30/100.
  - Color semantics for streaks (e.g., flame color scale, at-risk warning state) standardized in Design System.
- Telemetry
  - Track general/per-habit streak metrics; success/failure days; forgiven usage; milestones.
- Docs & OpenAPI
  - Document header progress UI and config fields; ensure OpenAPI mirrors any new config endpoints.

Notes
- Current algorithm: floor(completed/total*100) >= 80 and no unforgiven bad; zero-good days freeze unless an unforgiven bad occurs.
- Per-habit rules: good streak increments on consecutive done; bad “clean” streak increments unless unforgiven occurs (forgiven is neutral).

Next Steps (proposed)
1) Backend: add per-user config for `streakSuccessThreshold` (0–100) and apply in `computeGeneralStreak`.
2) iOS: add threshold slider in `UserConfigSheet` and read on header to colorize progress; trigger celebration at threshold.
3) Header UI: add compact progress bar and at‑risk state.
4) Telemetry: define events and wire minimal logging hooks.

